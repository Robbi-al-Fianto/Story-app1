const SHELL_CACHE="story-app-shell-v1",SHELL_FILES=["index.html","app.bundle.js","styles.css","manifest.json","icons/icon-144.png","icons/icon-192.png","icons/icon-512.png","screenshots/ss1.png","screenshots/ss2.png"];self.addEventListener("install",(e=>{e.waitUntil(caches.open(SHELL_CACHE).then((e=>e.addAll(SHELL_FILES))).catch((e=>{console.error("Cache shell gagal:",e)}))),self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==SHELL_CACHE)).map((e=>caches.delete(e))))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request))))})),self.addEventListener("push",(e=>{let t={title:"New Notification",body:"You have a new message",url:"/"};try{t=e.data.json()}catch{}const n={body:t.body,icon:"icons/icon-192.png",badge:"icons/icon-512.png",data:{url:t.url}};e.waitUntil(self.registration.showNotification(t.title,n))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification.data.url||"/";e.waitUntil(clients.matchAll({type:"window"}).then((e=>{const n=e.find((e=>e.url===t));return n?n.focus():clients.openWindow(t)})))}));